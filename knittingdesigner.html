<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knitting Chart Pattern Designer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f9f9f9;
            padding-bottom: 25px;
        }

        h1 {
            margin: 20px;
            color: #4a4a4a;
            text-align: center;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
            width: 90%;
            padding: 10px;
        }

        .controls select,
        .controls input[type="color"],
        .controls input[type="text"],
        .controls button {
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            cursor: pointer;
            flex: 1;
            min-width: 70px;
        }

        .controls button {
            background-color: #007BFF;
            color: white;
        }

        .controls button:hover {
            background-color: #0056b3;
        }

        .grid {
            display: grid;
            gap: 1px;
            background-color: #ddd;
        }

        .cell {
            width: 30px;
            height: 30px;
            background-color: white;
            border: 1px solid #ccc;
            text-align: center;
            font-size: 22px;
            cursor: pointer;
        }

        .cell:hover {
            border-color: #888;
        }

        .grid-container {
            width: 100%;
            overflow-x: auto;
            overflow-y: hidden;
            border: 1px solid #f9f9f9;
            display: flex;
            justify-content: center;
            background-color: #f9f9f9;
        }

        .grid {
            display: grid;
            gap: 1px;
            background-color: #ddd;
        }


        @media (max-width: 300px) {
            .controls {
                flex-direction: column;
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <h1>Knitting Chart Pattern Designer</h1>

    <div class="controls">
        <select id="stitchPicker">
            <option value="">Select Stitch</option>
            <option value="K">Knit (K)</option>
            <option value="P">Purl (P)</option>
            <option value="/">K2tog (/)</option>
            <option value="//">M1R (//)</option>
            <option value="\">SSK (\)</option>
            <option value="\\">M1L (\\)</option>
            <option value="O">Yarn Over (O)</option>
        </select>
        <input type="color" id="colorPicker" value="#ffffff" style="background-color: #ffffff;">
        <input type="text" id="rowsInput" placeholder="Rows (3-100)" value="20">
        <input type="text" id="colsInput" placeholder="Columns (3-100)" value="20">
        <button id="resizeButton">Resize Grid</button>
        <button id="clearButton">Clear Grid</button>
        <input type="text" id="fileNameInput" placeholder="File name">
        <button id="downloadButton">Download Chart</button>
    </div>

    <div class="grid-container">
        <div class="grid" id="grid"></div>
    </div>

    <script>
        const grid = document.getElementById('grid');
        const stitchPicker = document.getElementById('stitchPicker');
        const colorPicker = document.getElementById('colorPicker');
        const clearButton = document.getElementById('clearButton');
        const downloadButton = document.getElementById('downloadButton');
        const resizeButton = document.getElementById('resizeButton');
        const rowsInput = document.getElementById('rowsInput');
        const colsInput = document.getElementById('colsInput');
        const fileNameInput = document.getElementById('fileNameInput');

        function createGrid(rows, cols) {
            grid.innerHTML = '';
            grid.style.gridTemplateColumns = `repeat(${cols}, 30px)`;
            grid.style.gridTemplateRows = `repeat(${rows}, 30px)`;

            for (let i = 0; i < rows * cols; i++) {
                const cell = document.createElement('div');
                cell.classList.add('cell');

                // Add behavior for cell clicks
                cell.addEventListener('click', () => {
                    const selectedColor = colorPicker.value;
                    const selectedStitch = stitchPicker.value;

                    if (selectedColor) {
                        cell.style.backgroundColor = selectedColor;
                    }

                    if (selectedStitch) {
                        cell.textContent = selectedStitch;
                    }
                });

                grid.appendChild(cell);
            }
        }

        // Update the background color of the color picker
        colorPicker.addEventListener('input', () => {
            colorPicker.style.backgroundColor = colorPicker.value;
        });

        // Initial grid creation
        createGrid(20, 20);

        // Validate input
        function validateInput(value) {
            const num = parseInt(value, 10);
            return !isNaN(num) && num >= 3 && num <= 100;
        }

        // Resize grid
        resizeButton.addEventListener('click', () => {
            const rows = rowsInput.value.trim();
            const cols = colsInput.value.trim();

            if (!validateInput(rows) || !validateInput(cols)) {
                alert('Please enter valid numbers between 3 and 100 for rows and columns.');
                return;
            }

            createGrid(parseInt(rows, 10), parseInt(cols, 10));
        });

        // Clear grid
        clearButton.addEventListener('click', () => {
            document.querySelectorAll('.cell').forEach(cell => {
                cell.textContent = '';
                cell.style.backgroundColor = 'white';
            });
        });

        // Download design
        downloadButton.addEventListener('click', () => {
            let chart = '';
            const cells = document.querySelectorAll('.cell');
            const cols = parseInt(colsInput.value, 10);

            for (let i = 0; i < cells.length; i++) {
                const cell = cells[i];
                const stitch = cell.textContent;

                if (stitch.length > 0) {
                    chart += stitch;
                    if (stitch.length == 1) {
                        chart += ' ';
                    }
                } else {
                    chart += '. '; // Use '.' for empty cells
                }
                chart += '|';

                if ((i + 1) % cols === 0) {
                    chart += '\n'; // New row after every specified number of columns
                }
            }

            const fileName = fileNameInput.value.trim() || 'knitting-chart.txt';

            const blob = new Blob([chart], { type: 'text/plain' });
            const link = document.createElement('a');
            link.download = fileName;
            link.href = URL.createObjectURL(blob);
            link.click();
        });
    </script>
</body>
</html>